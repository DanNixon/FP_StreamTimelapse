<html>
<head>
<title>FP_StreamTimelaspe Cloud Test</title>
<style type="text/css">
	#map-canvas, #map_canvas {
	  height: 300px;
	  width: 300px;
	}
</style>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script>
	var map;
	var marker;

	function httpGet(theUrl)
	{
	    var xmlHttp = null;
	    xmlHttp = new XMLHttpRequest();
	    xmlHttp.open("GET", theUrl, false);
	    xmlHttp.send(null);
	    return xmlHttp.responseText;
	}

	function initialize() {
	  var gps_data = JSON.parse(httpGet("http://37.139.30.37/gps.txt"));
	  var current_pos = new google.maps.LatLng(gps_data.lat, gps_data.lon);
	  var mapOptions = {
	    zoom: 14,
	    center: current_pos,
	    mapTypeId: google.maps.MapTypeId.STREET
	  };
	  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
	  
	  marker = new google.maps.Marker({
		position: current_pos,
		map: map
		});
	}

	function httpGet(theUrl)
	{
		var xmlHttp = null;
		xmlHttp = new XMLHttpRequest();
		xmlHttp.open("GET", theUrl, false);
		xmlHttp.send(null);
		return xmlHttp.responseText;
	}

	function update_map()
	{
		var gps_data = JSON.parse(httpGet("http://37.139.30.37/gps.txt"));
		var current_pos = new google.maps.LatLng(gps_data.lat, gps_data.lon);
		marker.setPosition(current_pos);
		document.getElementById("lat").innerText = gps_data.lat;
		document.getElementById("lon").innerText = gps_data.lon;
		document.getElementById("speed").innerText = gps_data.speed;
		document.getElementById("track").innerText = gps_data.track;
		document.getElementById("alti").innerText = gps_data.alt;
	}

	google.maps.event.addDomListener(window, 'load', initialize);
	self.setInterval(function(){update_map()}, 1000);
</script>
</head>
<body>
<img src="http://37.139.30.37:8080/?action=stream" />
<br />
<div id="map-canvas"></div>
<p>
Latitude: <span id="lat"></span>&deg;<br />
Longitude: <span id="lon"></span>&deg;<br />
Speed: <span id="speed"></span> ms-1<br />
Heading: <span id="track"></span>&deg;<br />
Altitude: <span id="alti"></span> m
</p>
</body>
</html>
