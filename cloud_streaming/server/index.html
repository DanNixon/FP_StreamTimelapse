<html>
<head>
<title>FP_StreamTimelaspe Cloud Test</title>
<style type="text/css">
	#map-canvas, #map_canvas {
	  height: 300px;
	  width: 300px;
	}
</style>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script>
	var map;
	var markers = [];

	function httpGet(theUrl)
	{
	    var xmlHttp = null;
	    xmlHttp = new XMLHttpRequest();
	    xmlHttp.open("GET", theUrl, false);
	    xmlHttp.send(null);
	    return xmlHttp.responseText;
	}

	function initialize() {
	  var gps_data = JSON.parse(httpGet("http://37.139.30.37/gps.txt"));
	  var current_pos = new google.maps.LatLng(gps_data.lat, gps_data.lon);
	  var mapOptions = {
	    zoom: 15,
	    center: current_pos,
	    mapTypeId: google.maps.MapTypeId.STREET
	  };
	  map = new google.maps.Map(document.getElementById('map-canvas'),
	      mapOptions);

	    addMarker(current_pos);
	}

	function addMarker(location) {
	  var marker = new google.maps.Marker({
	    position: location,
	    map: map
	  });
	  markers.push(marker);
	}

	function deleteOverlays() {
	  for (var i = 0; i < markers.length; i++) {
	    markers[i].setMap(null);
	  }
	  markers = [];
	}

	function httpGet(theUrl)
	{
		var xmlHttp = null;
		xmlHttp = new XMLHttpRequest();
		xmlHttp.open("GET", theUrl, false);
		xmlHttp.send(null);
		return xmlHttp.responseText;
	}

	function update_map()
	{
		var gps_data = JSON.parse(httpGet("http://37.139.30.37/gps.txt"));
		var current_pos = new google.maps.LatLng(gps_data.lat, gps_data.lon);
		deleteOverlays();
		addMarker(current_pos);
	}

	google.maps.event.addDomListener(window, 'load', initialize);
	self.setInterval(function(){update_map()}, 1000);
</script>
</head>
<body>
<img src="http://37.139.30.37:8080/?action=stream" />
<br />
<div id="map-canvas"></div>
</body>
</html>
